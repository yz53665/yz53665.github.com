---
layout: post
title: WSL2的使用
categories:
- linux
---

# WSL2使用

## 安装windows terminal

windows terminal 是微软官方推出的控制台，支持高度自定义和64位彩色显示。

可以通过win10/win11自带的Microsoft Store安装，直接在商店中搜索**terminal**，然后选择安装即可。



## 安装wsl2

选择以管理员身份运行PowerShell，然后输入以下指令安装

```powershell
wsl --install
```
默认安装wsl2和Ubuntu发行版，如果需要wsl1和其它发行版，请参考[安装 WSL | Microsoft Docs](https://docs.microsoft.com/zh-cn/windows/wsl/install)

## 启动WSL2

安装完成后，可以通过Windows Terminal窗口上方标签栏右侧的下三角选择相应的Linux发行版启动。

可以在设置内选择每次启动默认为Ubuntu。

![image-20220124124807715](/img/image-20220124124807715.png)

第一次启动时会要求你输入Unix用户名和密码，剩下的内容请参考Linux教程。

## 关于WSL2的常见使用问题

在大多数情况下，WSL2的体验与Linux下并无太大差异，但有几个特殊场景需要注意

### 修改启动默认目录

默认情况下启动目录为c盘的用户目录，而不是Linux下的用户目录。可以在Terminal中修改默认启动目录为/home/{你的用户名}，这样每次启动默认为Linux用户目录。

![image-20220124165638197](/img/image-20220124165638197.png)

### 在WSL2中访问Windows下目录

windows下所有系统盘符在wsl2下都被映射到**/mnt/x/**中，x为windows下的盘符，如**D:\MyFile**在WSL2下的目录为**/mnt/d/MyFile**。此外，在WSL下相应的目录下输入**explorer.exe**可以打开windows资源管理器访问该文件夹下文件。

### 在Windows中访问WSL2中网络应用

使用Linux最主要的目的就是为了它便捷的环境配置和高效的开源软件。如果需要使用WSL2作为网络服务器启动网页或MySQL服务，直接在Windows下访问localhost和对应端口号即可。

### 在WSL2中访问Windows下网络应用

如果需要从WSL2中访问Windows下的网络应用会更加复杂一点。每次启动时系统都会给WSL2随机分配一个访问Windows的IP地址，具体可以在WSL2中输入以下指令来获得：

```shell
cat /etc/resolve.cnf
```

每次启动都要重新修改还是比较麻烦的，可以在环境配置文件里（如.bashrc、.zshrc等）添加以下内容来实现每次重启时自动提取主机IP：

```bash
export hostip=$(cat /etc/resolv.conf | grep nameserver | awk '{ print $2 }')
```

需要调用时使用**$hostip**即可。