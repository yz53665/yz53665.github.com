---
layout: post
title: Linux下基于Mingw的QT开发环境配置
categories:
- linux
- qt
---

<div id="outline-container-org8923e4d" class="outline-2">
<h2 id="org8923e4d">背景</h2>
<div class="outline-text-2" id="text-org8923e4d">
<p>
开发环境为linux,程序运行环境为windows,项目使用了windows下特有的QT库,这使得其
无法在Linux下进行开发.
</p>
</div>
</div>

<div id="outline-container-orgb2fef38" class="outline-2">
<h2 id="orgb2fef38">MXE</h2>
<div class="outline-text-2" id="text-orgb2fef38">
<p>
<a href="https://mxe.cc/">MXE</a>(M Cross Environment)是一个GNU的Makefile系统,本质是一堆Makefile文件,用于交
叉编译各种平台下的编译器,开源软件,如QT,SQL等.对于Windows,它提供了Mingw-w64工
具链,可以非常方便的编译绝大多数的库.
</p>
</div>
</div>

<div id="outline-container-orgc99c96e" class="outline-2">
<h2 id="orgc99c96e">MXE安装</h2>
<div class="outline-text-2" id="text-orgc99c96e">
<p>
MXE官网提供了两种安装方式:1.Linux发行版仓库; 2.源码编译
</p>

<p>
我使用的Linux发行版为Ubuntu20.04,下载MXE奇慢无比,如果不是CPU特别拉跨不如直接
源码编译来的快.这里只讲解源码编译,仓库下载请参考<a href="https://mxe.cc/">官网</a>说明.
</p>

<p>
Ubuntu发行版下需要安装一些前置库(其它发行版请参考官网说明):
</p>
<div class="org-src-container">
<pre class="src src-bash">apt-get install <span style="color: #66cccc;">\</span>
 autoconf <span style="color: #66cccc;">\</span>
 automake <span style="color: #66cccc;">\</span>
 autopoint <span style="color: #66cccc;">\</span>
 bash <span style="color: #66cccc;">\</span>
 bison <span style="color: #66cccc;">\</span>
 bzip2 <span style="color: #66cccc;">\</span>
 flex <span style="color: #66cccc;">\</span>
 g++ <span style="color: #66cccc;">\</span>
 g++-multilib <span style="color: #66cccc;">\</span>
 gettext <span style="color: #66cccc;">\</span>
 git <span style="color: #66cccc;">\</span>
 gperf <span style="color: #66cccc;">\</span>
 intltool <span style="color: #66cccc;">\</span>
 libc6-dev-i386 <span style="color: #66cccc;">\</span>
 libgdk-pixbuf2.0-dev <span style="color: #66cccc;">\</span>
 libltdl-dev <span style="color: #66cccc;">\</span>
 libssl-dev <span style="color: #66cccc;">\</span>
 libtool-bin <span style="color: #66cccc;">\</span>
 libxml-parser-perl <span style="color: #66cccc;">\</span>
 lzip <span style="color: #66cccc;">\</span>
 make <span style="color: #66cccc;">\</span>
 openssl <span style="color: #66cccc;">\</span>
 p7zip-full <span style="color: #66cccc;">\</span>
 patch <span style="color: #66cccc;">\</span>
 perl <span style="color: #66cccc;">\</span>
 python <span style="color: #66cccc;">\</span>
 ruby <span style="color: #66cccc;">\</span>
 sed <span style="color: #66cccc;">\</span>
 unzip <span style="color: #66cccc;">\</span>
 wget <span style="color: #66cccc;">\</span>
 xz-utils
</pre>
</div>

<p>
从github克隆项目:
</p>
<div class="org-src-container">
<pre class="src src-bash">git clone https://github.com/mxe/mxe.git
</pre>
</div>

<p>
然后可以把项目移动到 <b>opt</b> 路径下(linux下的大型程序或库都可以放在这个文件夹
下,官方推荐):
</p>
<div class="org-src-container">
<pre class="src src-bash">sudo mv mxe /opt/mxe
<span style="color: #cc99cc;">cd</span> /opt/mxe
</pre>
</div>
</div>
</div>

<div id="outline-container-org0ade45c" class="outline-2">
<h2 id="org0ade45c">MXE基本使用</h2>
<div class="outline-text-2" id="text-org0ade45c">
<p>
目前MXE下Mingw支持4个平台:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">平台</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">x86_64-w64-mingw32.static</td>
<td class="org-left">64位系统静态库</td>
</tr>

<tr>
<td class="org-left">x86_64-w64-mingw32.shared</td>
<td class="org-left">64位系统动态库</td>
</tr>

<tr>
<td class="org-left">i686-w64-mingw32.static</td>
<td class="org-left">32位系统静态库</td>
</tr>

<tr>
<td class="org-left">i686-w64-mingw32.shared</td>
<td class="org-left">32位系统动态库</td>
</tr>
</tbody>
</table>

<p>
静态库就是想生成单个可执行文件,动态库就是一个可执行文件带一大堆.dll文件,以上
平台可以在编译时使用 <b>MXE_TARGETS</b> 来指定.
</p>

<p>
我编译QT时使用如下指令:
</p>

<div class="org-src-container">
<pre class="src src-bash">make <span style="color: #ffcc66;">MXE_TARGETS</span>=<span style="color: #66cccc;">'x86_64-w64-mingw32.static x86_64-w64-mingw32.shared'</span> qt5 -j 7 -k
</pre>
</div>

<ul class="org-ul">
<li>MXE_TARGETS 用于指定编译平台</li>
<li>qt5 为想要编译的库</li>
<li>-j 7 为编译时最高使用7个cpu核心并行编译</li>
<li>-k 为在编译过程中如果发生错误,跳过错误相关编译流程,尽可能继续往下执行,如果
不加这个flag,编译出错会直接退出</li>
</ul>

<p>
编译时间较长,可以睡个午觉起来再看结果.
如果编译中有错误导致一些库没有编译成功,输入上面的指令重新编译就行,
大部分的错误是由于网络环境不佳导致一些库下载错误.
</p>
</div>
</div>

<div id="outline-container-org3e03746" class="outline-2">
<h2 id="org3e03746">编译所需库下载错误</h2>
<div class="outline-text-2" id="text-org3e03746">
<p>
如果某些库下载特别慢或下载错误,可以进入/mxe/log/文件夹下找到对应库名的log
文件,在里面有下载地址,直接复制下载地址并使用浏览器或其它下载工具下载,下载后的
包重命名为log文件中对应的名字并将其放入/mxe/pkg/文件夹下,重新运行上面的指令即
可跳过相关下载流程.</p>
</div>
</div>
